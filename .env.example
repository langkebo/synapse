# Synapse2 环境变量配置模板
# 复制此文件为 .env 并修改相应的值

# ================================
# 服务器基本配置
# ================================

# 服务器域名 (必填)
SERVER_NAME=matrix.yourdomain.com

# 配置和数据目录
SYNAPSE_CONFIG_DIR=./data
SYNAPSE_DATA_DIR=./data

# 日志级别 (DEBUG, INFO, WARNING, ERROR)
SYNAPSE_LOG_LEVEL=INFO

# ================================
# 数据库配置
# ================================

# PostgreSQL 数据库配置
POSTGRES_DB=synapse
POSTGRES_USER=synapse_user
POSTGRES_PASSWORD=CHANGE_ME_SECURE_PASSWORD
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# 数据库连接池配置
POSTGRES_MIN_CONNECTIONS=2
POSTGRES_MAX_CONNECTIONS=5
POSTGRES_CONNECTION_TIMEOUT=30

# ================================
# Redis 缓存配置
# ================================

# Redis 连接配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
REDIS_DB=0

# Redis 内存配置 (MB)
REDIS_MAX_MEMORY=256
REDIS_EVICTION_POLICY=allkeys-lru

# ================================
# Synapse 安全配置
# ================================

# 注册共享密钥 (用于创建用户)
SYNAPSE_REGISTRATION_SHARED_SECRET=CHANGE_ME_REGISTRATION_SECRET

# Macaroon 密钥 (用于访问令牌)
SYNAPSE_MACAROON_SECRET_KEY=CHANGE_ME_MACAROON_SECRET

# 表单密钥 (用于 CSRF 保护)
SYNAPSE_FORM_SECRET=CHANGE_ME_FORM_SECRET

# ================================
# 性能优化配置
# ================================

# 工作进程数 (1核服务器建议设为1)
SYNAPSE_WORKERS=1

# 缓存因子 (0.1-1.0，越小内存占用越少)
SYNAPSE_CACHE_FACTOR=0.5

# 事件缓存大小
SYNAPSE_EVENT_CACHE_SIZE=5K

# 最大并发请求数
SYNAPSE_MAX_CONCURRENT_REQUESTS=50

# 请求超时时间 (秒)
SYNAPSE_REQUEST_TIMEOUT=60

# ================================
# 内存优化配置
# ================================

# 最大内存使用 (MB)
SYNAPSE_MAX_MEMORY_USAGE=1536

# 垃圾回收阈值
SYNAPSE_GC_THRESHOLDS=700,10,10

# 内存缓存最大大小 (MB)
MEMORY_CACHE_MAX_SIZE=128

# 内存缓存 TTL (秒)
MEMORY_CACHE_TTL=3600

# ================================
# 好友功能配置
# ================================

# 启用好友功能
FRIENDS_ENABLED=true

# 每个用户最大好友数
FRIENDS_MAX_PER_USER=500

# 好友请求超时时间 (秒，默认7天)
FRIENDS_REQUEST_TIMEOUT=604800

# 好友列表缓存 TTL (秒)
FRIENDS_LIST_CACHE_TTL=3600

# 好友请求缓存 TTL (秒)
FRIENDS_REQUEST_CACHE_TTL=1800

# 在线状态缓存 TTL (秒)
FRIENDS_ONLINE_STATUS_TTL=300

# 好友推荐缓存 TTL (秒)
FRIENDS_RECOMMENDATIONS_TTL=7200

# ================================
# 速率限制配置
# ================================

# 发送好友请求速率限制
FRIENDS_SEND_REQUEST_RATE=10/hour

# 接受好友请求速率限制
FRIENDS_ACCEPT_REQUEST_RATE=20/hour

# 搜索用户速率限制
FRIENDS_SEARCH_USERS_RATE=30/minute

# 登录速率限制
LOGIN_RATE_PER_SECOND=0.17
LOGIN_RATE_BURST_COUNT=3

# ================================
# 监控配置
# ================================

# 启用监控
MONITOR_ENABLED=true

# 监控间隔 (秒)
MONITOR_INTERVAL=60

# CPU 使用率告警阈值 (%)
ALERT_THRESHOLD_CPU=80

# 内存使用率告警阈值 (%)
ALERT_THRESHOLD_MEMORY=85

# 磁盘使用率告警阈值 (%)
ALERT_THRESHOLD_DISK=90

# 启用邮件告警
ALERT_EMAIL_ENABLED=false
ALERT_EMAIL_SMTP_HOST=smtp.yourdomain.com
ALERT_EMAIL_SMTP_PORT=587
ALERT_EMAIL_USERNAME=alerts@yourdomain.com
ALERT_EMAIL_PASSWORD=CHANGE_ME_EMAIL_PASSWORD
ALERT_EMAIL_TO=admin@yourdomain.com

# 启用 Webhook 告警
ALERT_WEBHOOK_ENABLED=false
ALERT_WEBHOOK_URL=https://yourdomain.com/webhook/alerts

# ================================
# 网络配置
# ================================

# Synapse HTTP 端口
HTTP_PORT=8008

# Synapse HTTPS 端口
HTTPS_PORT=8448

# Nginx HTTP 端口
NGINX_HTTP_PORT=80

# Nginx HTTPS 端口
NGINX_HTTPS_PORT=443

# 最大上传文件大小
MAX_UPLOAD_SIZE=10M

# 最大图片像素数
MAX_IMAGE_PIXELS=32000000

# 联邦超时时间 (秒)
FEDERATION_TIMEOUT=30

# ================================
# SSL/TLS 配置
# ================================

# SSL 证书路径 (如果使用自定义证书)
SSL_CERT_PATH=/etc/ssl/certs/synapse.crt
SSL_KEY_PATH=/etc/ssl/private/synapse.key

# Let's Encrypt 配置
LETSENCRYPT_EMAIL=admin@yourdomain.com
LETSENCRYPT_STAGING=false

# ================================
# 媒体存储配置
# ================================

# 媒体存储目录
MEDIA_STORE_PATH=./data/media_store

# 媒体缓存大小 (MB)
MEDIA_CACHE_SIZE=1024

# 媒体缓存 TTL (秒)
MEDIA_CACHE_TTL=86400

# 启用媒体压缩
MEDIA_COMPRESSION_ENABLED=true

# ================================
# 用户注册配置
# ================================

# 启用公开注册
ENABLE_REGISTRATION=false

# 注册需要令牌
REGISTRATION_REQUIRES_TOKEN=true

# 启用邮箱验证
EMAIL_VALIDATION_ENABLED=false

# SMTP 配置 (用于邮箱验证)
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USERNAME=noreply@yourdomain.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_FROM=noreply@yourdomain.com

# ================================
# 推送通知配置
# ================================

# 启用推送通知
PUSH_NOTIFICATIONS_ENABLED=true

# 推送网关 URL
PUSH_GATEWAY_URL=https://matrix.org/_matrix/push/v1/notify

# ================================
# 联邦配置
# ================================

# 启用联邦
FEDERATION_ENABLED=true

# 联邦域名白名单 (可选，用逗号分隔)
FEDERATION_DOMAIN_WHITELIST=

# 联邦域名黑名单 (可选，用逗号分隔)
FEDERATION_DOMAIN_BLACKLIST=

# ================================
# 开发和调试配置
# ================================

# 启用调试模式
DEBUG_MODE=false

# 启用 SQL 查询日志
SQL_LOGGING_ENABLED=false

# 启用性能分析
PROFILING_ENABLED=false

# ================================
# 备份配置
# ================================

# 备份目录
BACKUP_DIR=./backups

# 备份保留天数
BACKUP_RETENTION_DAYS=7

# 启用自动备份
AUTO_BACKUP_ENABLED=true

# 备份时间 (cron 格式)
BACKUP_SCHEDULE=0 2 * * *

# ================================
# 时区配置
# ================================

# 系统时区
TZ=Asia/Shanghai

# ================================
# 其他配置
# ================================

# 启用用户目录
USER_DIRECTORY_ENABLED=true

# 启用 URL 预览
URL_PREVIEW_ENABLED=true

# URL 预览缓存大小 (MB)
URL_PREVIEW_CACHE_SIZE=100

# 启用统计报告
REPORT_STATS=false

# 启用实验性功能
EXPERIMENTAL_FEATURES_ENABLED=false