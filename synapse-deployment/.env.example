# Synapse Matrix服务器环境变量配置
# 复制此文件为 .env 并修改相应的值

# =============================================================================
# 基本配置
# =============================================================================

# Synapse服务器域名 (必须修改)
SYNAPSE_SERVER_NAME=matrix.cjystx.top


# 管理员邮箱
SYNAPSE_ADMIN_EMAIL=admin@cjystx.top

# Element客户端域名
ELEMENT_DOMAIN=element.cjystx.top

# 监控面板域名
MONITORING_DOMAIN=monitoring.cjystx.top

# =============================================================================
# 数据库配置
# =============================================================================

# PostgreSQL数据库密码 (强烈建议修改)
POSTGRES_PASSWORD=IaAqFjGVyyPJvOMAPfBk0FNjovC96neg

# 数据库连接配置
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=synapse
POSTGRES_USER=synapse

# =============================================================================
# Redis配置
# =============================================================================

# Redis密码 (强烈建议修改)
REDIS_PASSWORD=usjfAuN6L3EIwWA3euItxhjiPP4biuJB

# Redis连接配置
REDIS_HOST=redis
REDIS_PORT=6379

# =============================================================================
# 监控配置
# =============================================================================

# Grafana管理员密码 (强烈建议修改)
GRAFANA_PASSWORD=B9VStFYzUVTXHdwNVKFRVnIGTZshHbAg

# Prometheus配置
PROMETHEUS_RETENTION_TIME=7d
PROMETHEUS_RETENTION_SIZE=1GB

# =============================================================================
# 好友功能配置
# =============================================================================

# 启用好友功能
FRIENDS_ENABLED=true

# 每个用户最大好友数量
FRIENDS_MAX_FRIENDS=500

# 好友请求超时时间（秒）
FRIENDS_REQUEST_TIMEOUT=604800  # 7天

# 好友搜索速率限制（每分钟请求数）
FRIENDS_SEARCH_RATE_LIMIT=30

# 好友操作速率限制（每分钟请求数）
FRIENDS_ACTION_RATE_LIMIT=10

# =============================================================================
# 性能优化配置
# =============================================================================

# Synapse缓存因子 (0.1-2.0，越高占用内存越多)
SYNAPSE_CACHE_FACTOR=0.5

# 事件缓存大小
SYNAPSE_EVENT_CACHE_SIZE=5K

# 最大上传文件大小 (字节)
SYNAPSE_MAX_UPLOAD_SIZE=52428800  # 50MB

# 媒体文件保留时间（天）
SYNAPSE_MEDIA_RETENTION_DAYS=365

# =============================================================================
# SSL/TLS配置
# =============================================================================

# SSL证书路径（如果使用自定义证书）
SSL_CERT_PATH=./ssl/cert.pem
SSL_KEY_PATH=./ssl/key.pem

# Let's Encrypt配置（如果使用自动证书）
LETSENCRYPT_EMAIL=admin@cjystx.top
LETSENCRYPT_DOMAIN=matrix.cjystx.top
LETSENCRYPT_ELEMENT_DOMAIN=element.cjystx.top
LETSENCRYPT_MONITORING_DOMAIN=monitoring.cjystx.top

# =============================================================================
# 邮件配置（可选）
# =============================================================================

# SMTP服务器配置
SMTP_HOST=smtp.cjystx.top
SMTP_PORT=587
SMTP_USER=noreply@cjystx.top
SMTP_PASSWORD=g9JaW9BKCLpNXrBFXlkuBEm9zKi5sDFf
SMTP_FROM=noreply@cjystx.top

# =============================================================================
# 注册配置
# =============================================================================

# 是否允许公开注册
SYNAPSE_ENABLE_REGISTRATION=false

# 注册共享密钥（如果启用注册）
SYNAPSE_REGISTRATION_SHARED_SECRET=8aMklp4ci5FmUVS02JTPjQ6Teo8qu9O6

# =============================================================================
# 联邦配置
# =============================================================================

# 是否启用联邦
SYNAPSE_FEDERATION_ENABLED=true

# 联邦发送者数量
SYNAPSE_FEDERATION_SENDER_INSTANCES=1

# =============================================================================
# 日志配置
# =============================================================================

# 日志级别 (DEBUG, INFO, WARNING, ERROR, CRITICAL)
SYNAPSE_LOG_LEVEL=INFO

# 是否启用结构化日志
SYNAPSE_STRUCTURED_LOGGING=true

# =============================================================================
# 安全配置
# =============================================================================

# 密码策略
SYNAPSE_PASSWORD_MIN_LENGTH=8
SYNAPSE_PASSWORD_REQUIRE_UPPERCASE=true
SYNAPSE_PASSWORD_REQUIRE_LOWERCASE=true
SYNAPSE_PASSWORD_REQUIRE_NUMBERS=true
SYNAPSE_PASSWORD_REQUIRE_SYMBOLS=false

# 会话超时时间（秒）
SYNAPSE_SESSION_TIMEOUT=2592000  # 30天

# =============================================================================
# 中文化配置
# =============================================================================

# 默认语言
SYNAPSE_DEFAULT_LANGUAGE=zh_CN

# 时区
SYNAPSE_TIMEZONE=Asia/Shanghai

# =============================================================================
# 开发/调试配置
# =============================================================================

# 是否启用调试模式
DEBUG=false

# 是否启用性能分析
SYNAPSE_ENABLE_PROFILING=false

# 是否启用详细的HTTP日志
SYNAPSE_VERBOSE_HTTP_LOGGING=false

# =============================================================================
# 备份配置
# =============================================================================

# 数据库备份保留天数
BACKUP_RETENTION_DAYS=30

# 备份存储路径
BACKUP_PATH=./backups

# 是否启用自动备份
AUTO_BACKUP_ENABLED=true

# 备份时间（cron格式）
BACKUP_SCHEDULE="0 2 * * *"  # 每天凌晨2点

# =============================================================================
# 资源限制配置
# =============================================================================

# Docker容器资源限制
SYNAPSE_MEMORY_LIMIT=1g
SYNAPSE_CPU_LIMIT=0.8
POSTGRES_MEMORY_LIMIT=512m
POSTGRES_CPU_LIMIT=0.5
REDIS_MEMORY_LIMIT=256m
REDIS_CPU_LIMIT=0.3

# =============================================================================
# 网络配置
# =============================================================================

# Docker网络子网
DOCKER_SUBNET=172.20.0.0/16

# 端口映射
SYNAPSE_CLIENT_PORT=8008
SYNAPSE_FEDERATION_PORT=8448
SYNAPSE_METRICS_PORT=9090
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443
GRAFANA_PORT=3000
PROMETHEUS_PORT=9091